<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration>

<configuration>
    <springProperty scope="context" name="springAppName" source="spring.application.name"/>
    <springProperty scope="context" name="activeProfile" source="spring.profiles.active"/>

    <contextName>novo-simulador</contextName>
    <jmxConfigurator/>

    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>
                %d{yyyy-MM-dd} %d{HH:mm:ss} [%thread] [profile=${activeProfile}] [${springAppName:-},%X{X-B3-TraceId:-},%X{X-B3-SpanId:-},%X{X-B3-ParentSpanId:-},%X{X-Span-Export:-}] %-5level %logger - %msg%n
            </pattern>
        </encoder>
    </appender>

    <springProfile name="local,tst-cpt">
        <root level="INFO">
            <appender-ref ref="STDOUT"/>
        </root>
    </springProfile>

    <springProfile name="dev,ti,hml,prd">
        <appender name="GELF" class="biz.paluch.logging.gelf.logback.GelfLogbackAppender">
            <host>${GRAYLOG_HOST}</host>
            <port>${GRAYLOG_PORT}</port>
            <version>1.0</version>
            <extractStackTrace>true</extractStackTrace>
            <filterStackTrace>true</filterStackTrace>
            <mdcProfiling>true</mdcProfiling>
            <timestampPattern>yyyy-MM-dd HH:mm:ss,SSSS</timestampPattern>
            <additionalFields>profile=${activeProfile},aplicacao=${springAppName}</additionalFields>
            <includeFullMdc>true</includeFullMdc>
        </appender>

        <appender name="ASYNC-GELF-WARN" class="ch.qos.logback.classic.AsyncAppender">
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>WARN</level>
            </filter>
            <appender-ref ref="GELF"/>
        </appender>

        <appender name="ASYNC-GELF-STDIN" class="ch.qos.logback.classic.AsyncAppender">
            <appender-ref ref="GELF"/>
        </appender>

        <springProfile name="dev,ti,hml">
            <logger name="br.com.elo" level="INFO" additivity="false">
                <appender-ref ref="ASYNC-GELF-STDIN"/>
                <appender-ref ref="STDOUT"/>
            </logger>

            <root level="INFO">
                <appender-ref ref="ASYNC-GELF-WARN"/>
                <appender-ref ref="STDOUT"/>
            </root>
        </springProfile>

        <springProfile name="prd">
            <logger name="br.com.elo" level="INFO" additivity="false">
                <appender-ref ref="ASYNC-GELF-STDIN"/>
                <appender-ref ref="STDOUT"/>
            </logger>

            <root level="INFO">
                <appender-ref ref="ASYNC-GELF-WARN"/>
                <appender-ref ref="STDOUT"/>
            </root>
        </springProfile>

    </springProfile>

</configuration>